---
- name: Set directory permissions for release_drupal_path
  file:
    path: "{{ ansistrano_release_path }}"
    mode: "0755"
    state: directory
    recurse: yes
  tags:
    - pre-deploy

- name: Set directory permissions for ansistrano_shared_path
  file:
    path: "{{ ansistrano_shared_path }}/{{ project_web_root }}/sites/default/files"
    mode: "0770"
    state: directory
    owner: "{{ vault_server_client }}"
    group: "{{ vault_server_group }}"
    recurse: true
# - name: Update directory permissions
#   file:
#     path: "{{ item.path }}"
#     mode: "{{ item.mode }}"
#     state: directory
#     owner: "{{ vault_server_client }}"
#     group: "{{ vault_server_group }}"
#     recurse: true
#   loop:
#     - path: "{{ release_drupal_path }}"
#       mode: "0755"
#     - path: "{{ ansistrano_shared_path }}/{{ project_web_root }}/sites/default/files"
#       mode: "0770"
# - name: Update file permissions
#   file:
#     path: "{{ release_drupal_path }}/sites/default/settings.php"
#     mode: "0770"
#     state: file
#     owner: "{{ vault_server_client }}"
#     group: "{{ vault_server_group }}"
# ____
# ___

# - name: Set permissions for release_drupal_path
#   find:
#     paths: "{{ release_drupal_path }}"
#     recurse: yes
#     file_type: directory
#   register: drupal_path_files

# - name: Set permissions recursively for release_drupal_path
#   file:
#     path: "{{ item.path }}"
#     mode: "0755"
#     state: directory
#     owner: "{{ vault_server_client }}"
#     group: "{{ vault_server_group }}"
#   loop: "{{ drupal_path_files.files }}"

# - name: Set permissions for ansistrano_shared_path
#   find:
#     paths: "{{ ansistrano_shared_path }}/{{ project_web_root }}/sites/default/files"
#     recurse: yes
#     file_type: directory
#   register: shared_path_files

# - name: Set permissions recursively for ansistrano_shared_path
#   file:
#     path: "{{ item.path }}"
#     mode: "0770"
#     state: directory
#     owner: "{{ vault_server_client }}"
#     group: "{{ vault_server_group }}"
#   loop: "{{ shared_path_files.files }}"

# ====
